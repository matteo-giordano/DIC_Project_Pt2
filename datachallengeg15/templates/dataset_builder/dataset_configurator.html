<!-- Dataset Configurator Panel -->
<div class="generator-options" id="dataset-config-panel">
    <div class="section-title">Dataset Configuration</div>
    
    <div class="config-note">
        <div class="note-icon">ℹ️</div>
        <div class="note-text">
            This configuration controls the maze generation parameters for your dataset. 
            Each enabled generator will create mazes with all possible combinations of parameter values.
        </div>
    </div>
    
    <div class="global-options">
        <div class="option-row">
            <div class="checkbox-container">
                <input type="checkbox" name="ensure_connected_global" id="ensure-connected-global" checked>
                <label for="ensure-connected-global">Ensure all mazes are fully connected</label>
            </div>
        </div>
        <div class="option-row">
            <div class="checkbox-container">
                <input type="checkbox" name="ensure_unique_global" id="ensure-unique-global" checked>
                <label for="ensure-unique-global">Ensure all mazes are unique</label>
            </div>
        </div>
    </div>
    
    <h3>Generator Settings</h3>
    
    <!-- Generator Configuration Sections -->
    {% for gen_type, gen_info in generators.items() %}
    <div class="config-section" data-generator="{{ gen_type }}" data-enabled="{{ gen_type in generator_config.generators }}">
        <div class="config-header">
            <div class="config-title">{{ gen_info.name }}</div>
            <div class="status-indicator-container">
                <label class="toggle-switch">
                    <input type="checkbox" class="generator-toggle" 
                           name="{{ gen_type }}_enabled" 
                           {{ 'checked' if gen_type in generator_config.generators else '' }}>
                    <span class="toggle-slider"></span>
                </label>
                <div class="status-indicator">
                    <div class="status-light"></div>
                </div>
            </div>
        </div>
        <div class="config-content" {% if gen_type in generator_config.generators %}style="display: block"{% endif %}>
            {% if gen_type == 'manual' %}
            <!-- Special case for manual generator - simple toggle only -->
            <div class="param-grid">
                <div class="param-item" style="grid-column: span 2;">
                    <div class="config-note">
                        <div class="note-icon">ℹ️</div>
                        <div class="note-text">
                            When enabled, all saved manual mazes will be included in the dataset when you click "Generate Dataset".
                        </div>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="param-grid">
                <!-- Count per Configuration -->
                <div class="param-item">
                    <label class="param-label">Maps per Configuration</label>
                    <input type="number" class="param-value" name="{{ gen_type }}-count_per_config" 
                           value="{{ generator_config.generators[gen_type].count_per_config if gen_type in generator_config.generators else 10 }}" 
                           min="1" max="100">
                </div>
                
                <!-- Width Parameter -->
                <div class="param-item">
                    <label class="param-label">Width Values</label>
                    <div class="array-container" 
                         data-param-name="{{ gen_type }}-width" 
                         data-param-type="number" 
                         data-param-step="2"
                         data-param-min="3"
                         data-param-max="101">
                        {% if gen_type in generator_config.generators and generator_config.generators[gen_type].width %}
                            {% for width in generator_config.generators[gen_type].width %}
                            <div class="array-item">
                                <input type="number" class="array-item-value" name="{{ gen_type }}-width[]" 
                                       value="{{ width }}" min="3" max="101" step="2">
                                <button type="button" class="array-item-remove">×</button>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="array-item">
                                <input type="number" class="array-item-value" name="{{ gen_type }}-width[]" 
                                       value="21" min="3" max="101" step="2">
                                <button type="button" class="array-item-remove">×</button>
                            </div>
                        {% endif %}
                    </div>
                    <button type="button" class="array-add">+ Add Width</button>
                </div>
                
                <!-- Height Parameter -->
                <div class="param-item">
                    <label class="param-label">Height Values</label>
                    <div class="array-container" 
                         data-param-name="{{ gen_type }}-height" 
                         data-param-type="number" 
                         data-param-step="2"
                         data-param-min="3"
                         data-param-max="101">
                        {% if gen_type in generator_config.generators and generator_config.generators[gen_type].height %}
                            {% for height in generator_config.generators[gen_type].height %}
                            <div class="array-item">
                                <input type="number" class="array-item-value" name="{{ gen_type }}-height[]" 
                                       value="{{ height }}" min="3" max="101" step="2">
                                <button type="button" class="array-item-remove">×</button>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="array-item">
                                <input type="number" class="array-item-value" name="{{ gen_type }}-height[]" 
                                       value="21" min="3" max="101" step="2">
                                <button type="button" class="array-item-remove">×</button>
                            </div>
                        {% endif %}
                    </div>
                    <button type="button" class="array-add">+ Add Height</button>
                </div>
                
                <!-- Generator-specific parameters -->
                {% if gen_type == 'terrain' %}
                <div class="param-item">
                    <label class="param-label">Blob Density Values</label>
                    <div class="array-container" 
                         data-param-name="{{ gen_type }}-blob_density" 
                         data-param-type="number" 
                         data-param-step="0.001"
                         data-param-min="0.001"
                         data-param-max="0.05">
                        {% if gen_type in generator_config.generators and generator_config.generators[gen_type].blob_density %}
                            {% for density in generator_config.generators[gen_type].blob_density %}
                            <div class="array-item">
                                <input type="number" class="array-item-value" name="{{ gen_type }}-blob_density[]" 
                                       value="{{ density }}" min="0.001" max="0.05" step="0.001">
                                <button type="button" class="array-item-remove">×</button>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="array-item">
                                <input type="number" class="array-item-value" name="{{ gen_type }}-blob_density[]" 
                                       value="0.005" min="0.001" max="0.05" step="0.001">
                                <button type="button" class="array-item-remove">×</button>
                            </div>
                        {% endif %}
                    </div>
                    <button type="button" class="array-add">+ Add Density</button>
                </div>
                {% endif %}
                
                {% if gen_type == 'gaussian' %}
                <div class="param-item">
                    <label class="param-label">Threshold Values</label>
                    <div class="array-container" 
                         data-param-name="{{ gen_type }}-threshold" 
                         data-param-type="number" 
                         data-param-step="0.05"
                         data-param-min="0.5"
                         data-param-max="0.9">
                        {% if gen_type in generator_config.generators and generator_config.generators[gen_type].threshold %}
                            {% for threshold in generator_config.generators[gen_type].threshold %}
                            <div class="array-item">
                                <input type="number" class="array-item-value" name="{{ gen_type }}-threshold[]" 
                                       value="{{ threshold }}" min="0.5" max="0.9" step="0.05">
                                <button type="button" class="array-item-remove">×</button>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="array-item">
                                <input type="number" class="array-item-value" name="{{ gen_type }}-threshold[]" 
                                       value="0.65" min="0.5" max="0.9" step="0.05">
                                <button type="button" class="array-item-remove">×</button>
                            </div>
                        {% endif %}
                    </div>
                    <button type="button" class="array-add">+ Add Threshold</button>
                </div>
                
                <div class="param-item">
                    <label class="param-label">Sigma X Values</label>
                    <div class="array-container" 
                         data-param-name="{{ gen_type }}-sigma_x" 
                         data-param-type="number" 
                         data-param-step="0.1"
                         data-param-min="0.1"
                         data-param-max="5.0">
                        {% if gen_type in generator_config.generators and generator_config.generators[gen_type].sigma_x %}
                            {% for sigma in generator_config.generators[gen_type].sigma_x %}
                            <div class="array-item">
                                <input type="number" class="array-item-value" name="{{ gen_type }}-sigma_x[]" 
                                       value="{{ sigma }}" min="0.1" max="5.0" step="0.1">
                                <button type="button" class="array-item-remove">×</button>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="array-item">
                                <input type="number" class="array-item-value" name="{{ gen_type }}-sigma_x[]" 
                                       value="1.0" min="0.1" max="5.0" step="0.1">
                                <button type="button" class="array-item-remove">×</button>
                            </div>
                        {% endif %}
                    </div>
                    <button type="button" class="array-add">+ Add Sigma X</button>
                </div>
                
                <div class="param-item">
                    <label class="param-label">Sigma Y Values</label>
                    <div class="array-container" 
                         data-param-name="{{ gen_type }}-sigma_y" 
                         data-param-type="number" 
                         data-param-step="0.1"
                         data-param-min="0.1"
                         data-param-max="5.0">
                        {% if gen_type in generator_config.generators and generator_config.generators[gen_type].sigma_y %}
                            {% for sigma in generator_config.generators[gen_type].sigma_y %}
                            <div class="array-item">
                                <input type="number" class="array-item-value" name="{{ gen_type }}-sigma_y[]" 
                                       value="{{ sigma }}" min="0.1" max="5.0" step="0.1">
                                <button type="button" class="array-item-remove">×</button>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="array-item">
                                <input type="number" class="array-item-value" name="{{ gen_type }}-sigma_y[]" 
                                       value="1.0" min="0.1" max="5.0" step="0.1">
                                <button type="button" class="array-item-remove">×</button>
                            </div>
                        {% endif %}
                    </div>
                    <button type="button" class="array-add">+ Add Sigma Y</button>
                </div>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>
    {% endfor %}
    
    <div class="config-actions">
        <button class="config-btn" id="reset-generator-config">Reset</button>
        <button class="config-btn primary" id="save-generator-config">Generate Dataset</button>
    </div>
    
    <div id="generate-progress-container" class="progress-container" style="display: none;">
        <div class="progress-bar-label">Generating dataset...</div>
        <div class="progress-bar-outer">
            <div class="progress-bar-inner" id="generate-progress-bar"></div>
        </div>
        <div class="progress-status" id="generate-progress-status">Initializing...</div>
    </div>
    
    <div class="hint-text">
        This configuration controls the range of parameters used when generating the full dataset.
        Each generator can have different parameter sets to explore.
    </div>
</div>

<!-- Dataset Configurator JS -->
<script>
// Function to initialize the dataset configurator
function initDatasetConfigurator() {
    // Make generator cards clickable
    document.querySelectorAll('.config-section').forEach(section => {
        // Get header and content elements
        const header = section.querySelector('.config-header');
        const content = section.querySelector('.config-content');
        const toggle = section.querySelector('.generator-toggle');
        
        if (!header || !content || !toggle) return;
        
        // Set initial content visibility based on enabled state
        const isEnabled = section.getAttribute('data-enabled') === 'true';
        content.style.display = isEnabled ? 'block' : 'none';
        toggle.checked = isEnabled;
        section.setAttribute('data-enabled', isEnabled.toString());
        
        // Toggle visibility when clicking the header
        header.addEventListener('click', function(e) {
            // Don't toggle if clicking on the checkbox directly
            if (e.target === toggle || e.target.closest('.toggle-switch')) {
                return;
            }
            
            // Toggle display of content
            if (content.style.display === 'none' || content.style.display === '') {
                content.style.display = 'block';
            } else {
                content.style.display = 'none';
            }
        });
        
        // Toggle enabled state when checkbox changes
        toggle.addEventListener('change', function() {
            const isChecked = this.checked;
            section.setAttribute('data-enabled', isChecked.toString());
            
            // Make sure content is visible when enabled
            if (isChecked && (content.style.display === 'none' || content.style.display === '')) {
                content.style.display = 'block';
            }
        });
    });
    
    // Handle add/remove buttons for array items using event delegation
    document.querySelectorAll('.array-container').forEach(container => {
        container.addEventListener('click', function(e) {
            // Handle remove button clicks
            if (e.target.classList.contains('array-item-remove')) {
                // Check if this is the last item
                const items = this.querySelectorAll('.array-item');
                if (items.length <= 1) {
                    alert('Cannot remove the last item. At least one value is required.');
                    return;
                }
                
                // Remove the item
                e.target.parentNode.remove();
            }
        });
    });

    // Save configuration button
    document.getElementById('save-generator-config')?.addEventListener('click', function() {
        // Disable the button to prevent multiple clicks
        this.disabled = true;
        this.textContent = 'Processing...';
    });
}

// Initialize the dataset configurator when the DOM is loaded
document.addEventListener('DOMContentLoaded', initDatasetConfigurator);
</script> 